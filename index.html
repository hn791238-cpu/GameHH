<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ‘çš„å°æ¸¸æˆä»“åº“</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --text:#e8ecff;
      --muted:#aab3d6;
      --accent:#7c5cff;
      --line:#24305e;
      --danger:#ff4d6d;
      --ok:#34d399;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 30% -10%, rgba(124,92,255,.35), transparent 60%),
                  radial-gradient(1000px 600px at 100% 0%, rgba(52,211,153,.18), transparent 55%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
    }
    a{ color:inherit; }
    .wrap{ max-width: 1100px; margin: 0 auto; padding: 22px 16px 60px; }

    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
      padding: 18px 16px;
      border:1px solid var(--line);
      background: rgba(18,26,51,.7);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .title{ display:flex; flex-direction:column; gap:6px; }
    h1{ margin:0; font-size: 22px; letter-spacing:.2px; }
    .sub{ margin:0; color: var(--muted); font-size: 14px; line-height:1.45; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    button{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 600;
      transition: transform .08s ease, border-color .2s ease, background .2s ease;
    }
    button:hover{ border-color: rgba(124,92,255,.7); background: rgba(124,92,255,.10); }
    button:active{ transform: translateY(1px); }
    .primary{ border-color: rgba(124,92,255,.75); background: rgba(124,92,255,.16); }

    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
    }
    .card{
      grid-column: span 6;
      border:1px solid var(--line);
      background: rgba(18,26,51,.65);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:-50px;
      background: radial-gradient(500px 150px at 10% 10%, rgba(124,92,255,.16), transparent 55%);
      pointer-events:none;
    }
    .card h2{ margin:0 0 6px; font-size: 16px; position:relative; }
    .card p{ margin:0; color: var(--muted); font-size: 13px; line-height:1.55; position:relative; }
    .meta{ margin-top: 10px; display:flex; gap:8px; flex-wrap:wrap; position:relative; }
    .tag{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
    }
    .card .actions{ margin-top: 12px; display:flex; gap:10px; flex-wrap:wrap; position:relative; }

    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 16px;
      line-height:1.6;
      border-left: 3px solid rgba(124,92,255,.7);
      padding-left: 10px;
    }

    @media (max-width: 920px){
      .card{ grid-column: span 12; }
      header{ flex-direction:column; align-items:stretch; }
      .btns{ justify-content:flex-start; }
    }

    /* Modal */
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.7);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal.show{ display:flex; }
    .panel{
      width:min(1100px, 100%);
      height:min(720px, 92vh);
      background: rgba(18,26,51,.92);
      border:1px solid var(--line);
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      display:flex;
      flex-direction:column;
    }
    .panelTop{
      display:flex; align-items:center; justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .panelTitle{ font-weight: 800; font-size: 13px; color: var(--text); }
    .panelBtns{ display:flex; gap:8px; flex-wrap:wrap; }
    .panel iframe{ border:0; width:100%; height:100%; background:#000; }

    /* Dialog */
    dialog{
      border:1px solid var(--line);
      border-radius: 16px;
      background: rgba(18,26,51,.96);
      color: var(--text);
      padding: 14px;
      width: min(520px, 96vw);
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
    }
    dialog::backdrop{ background: rgba(0,0,0,.65); }
    .formRow{ display:flex; flex-direction:column; gap:6px; margin:10px 0; }
    label{ font-size: 12px; color: var(--muted); }
    input, textarea{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 10px;
      border-radius: 12px;
      outline:none;
      font: inherit;
    }
    textarea{ min-height: 90px; resize: vertical; }
    .rowBtns{ display:flex; justify-content:flex-end; gap:10px; margin-top: 12px; }
    .danger{ border-color: rgba(255,77,109,.6); background: rgba(255,77,109,.08); }
    .danger:hover{ border-color: rgba(255,77,109,.9); background: rgba(255,77,109,.12); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>ğŸ® æˆ‘çš„å°æ¸¸æˆä»“åº“</h1>
        <p class="sub">ä¸€ä¸ªæœ¬åœ°å°±èƒ½è·‘çš„â€œæ¸¸æˆåˆé›†ç½‘ç«™â€ã€‚ä½ ä»¥åæƒ³åŠ æ–°å°æ¸¸æˆï¼Œåªè¦æŠŠæ–°æ¸¸æˆçš„ <b>HTML æ–‡ä»¶</b>æ”¾åˆ° <code>games/</code> é‡Œï¼Œå†åœ¨ä¸‹é¢ç‚¹â€œæ·»åŠ æ¸¸æˆâ€å°±è¡Œã€‚</p>
      </div>
      <div class="btns">
        <button class="primary" id="addBtn">â• æ·»åŠ æ¸¸æˆ</button>
        <button id="resetBtn" class="danger" title="åªæ¸…ç©ºä½ æ‰‹åŠ¨æ·»åŠ çš„åˆ—è¡¨ï¼Œä¸ä¼šåˆ æ–‡ä»¶">ğŸ§¹ æ¸…ç©ºè‡ªå®šä¹‰åˆ—è¡¨</button>
        <button id="howBtn">ğŸ“Œ æ€ä¹ˆæ‰©å±•ï¼Ÿ</button>
      </div>
    </header>

    <div class="grid" id="grid"></div>

    <div class="small">
      <b>è¿è¡Œæ–¹å¼ï¼š</b>åŒå‡»æ‰“å¼€ <code>index.html</code> å°±èƒ½ç©ã€‚è‹¥é‡åˆ°æµè§ˆå™¨é™åˆ¶ï¼ˆå°‘æ•°æµè§ˆå™¨ä¼šæ‹¦ iframe æœ¬åœ°æ–‡ä»¶ï¼‰ï¼Œç”¨å‘½ä»¤è¡Œåœ¨è¿™ä¸ªç›®å½•æ‰§è¡Œ <code>python -m http.server 8080</code>ï¼Œç„¶åæ‰“å¼€ <code>http://localhost:8080</code>ã€‚
    </div>
  </div>

  <!-- Play Modal -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="panel">
      <div class="panelTop">
        <div class="panelTitle" id="panelTitle">æ¸¸æˆ</div>
        <div class="panelBtns">
          <button id="openNew">â†— æ–°çª—å£æ‰“å¼€</button>
          <button id="closeModal" class="danger">âœ• å…³é—­</button>
        </div>
      </div>
      <iframe id="frame" title="game"></iframe>
    </div>
  </div>

  <!-- Add Game Dialog -->
  <dialog id="dlg">
    <form method="dialog" id="form">
      <div style="font-weight:800; margin-bottom:6px;">æ·»åŠ ä¸€ä¸ªæ¸¸æˆå…¥å£</div>
      <div style="color:var(--muted); font-size:12px; line-height:1.6;">å¯ä»¥å¡«æœ¬åœ°æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>games/mygame.html</code>ï¼‰æˆ–åœ¨çº¿ URLï¼ˆä¾‹å¦‚ä½ ä»¥åéƒ¨ç½²åˆ° GitHub Pages çš„é“¾æ¥ï¼‰ã€‚</div>

      <div class="formRow">
        <label>æ¸¸æˆåç§°</label>
        <input name="name" required maxlength="40" placeholder="æ¯”å¦‚ï¼šè·³è·³å¹³å°" />
      </div>
      <div class="formRow">
        <label>è·¯å¾„ / URL</label>
        <input name="url" required placeholder="games/xxx.html æˆ– https://..." />
      </div>
      <div class="formRow">
        <label>ä¸€å¥è¯ä»‹ç»ï¼ˆå¯é€‰ï¼‰</label>
        <textarea name="desc" maxlength="200" placeholder="æ¯”å¦‚ï¼š2D å¹³å°è·³è·ƒï¼Œèº²éšœç¢æ‹¿é‡‘å¸"></textarea>
      </div>
      <div class="formRow">
        <label>æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰</label>
        <input name="tags" maxlength="80" placeholder="2D, è½»é‡, å•æœº" />
      </div>

      <div class="rowBtns">
        <button value="cancel">å–æ¶ˆ</button>
        <button class="primary" value="ok">ä¿å­˜</button>
      </div>
    </form>
  </dialog>

  <!-- How Dialog -->
  <dialog id="how">
    <form method="dialog">
      <div style="font-weight:800; margin-bottom:6px;">æ€ä¹ˆæŠŠæ›´å¤šå°æ¸¸æˆå¡è¿›æ¥ï¼Ÿ</div>
      <ol style="color:var(--muted); font-size:13px; line-height:1.7; padding-left: 18px;">
        <li>æŠŠæ–°æ¸¸æˆåšæˆä¸€ä¸ªç‹¬ç«‹çš„ <b>HTML</b> æ–‡ä»¶ï¼ˆä¸€èˆ¬é‡Œé¢åŒ…å«è‡ªå·±çš„ JS/CSSï¼‰ã€‚</li>
        <li>æŠŠå®ƒæ”¾è¿› <code>games/</code> æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚ <code>games/racing.html</code>ï¼‰ã€‚</li>
        <li>å›åˆ°é¦–é¡µç‚¹â€œæ·»åŠ æ¸¸æˆâ€ï¼Œå¡«åå­—å’Œè·¯å¾„å³å¯ã€‚</li>
        <li>æƒ³åˆ†äº«ç»™åˆ«äººï¼šæŠŠæ•´ä¸ªæ–‡ä»¶å¤¹éƒ¨ç½²åˆ° GitHub Pages / Netlify / Vercel éƒ½è¡Œï¼ˆçº¯é™æ€ç«™ç‚¹ï¼‰ã€‚</li>
      </ol>
      <div style="display:flex; justify-content:flex-end;">
        <button class="primary">çŸ¥é“äº†</button>
      </div>
    </form>
  </dialog>

  <script>
    const BUILTIN = [
      {
        id: 'zombie_scavenge',
        name: 'åŸå¸‚æ‹¾è’ï¼šé¿å¼€æ„ŸæŸ“è€…',
        url: 'games/zombie_scavenge.html',
        desc: '2D ä¿¯è§†è§’ã€‚ç»•å¼€éšœç¢ã€æ”¶é›†ç‰©èµ„ã€æ’‘è¿‡å¤œæ™šã€‚æ— è¡€è…¥ï¼Œä¸»æ‰“â€œèµ°ä½ + èµ„æºç®¡ç†â€ã€‚',
        tags: ['2D','èº²é¿','æ”¶é›†','æœ¬åœ°å¯ç©'],
      }
    ];

    const LS_KEY = 'mini_arcade_custom_games_v1';

    const els = {
      grid: document.getElementById('grid'),
      modal: document.getElementById('modal'),
      frame: document.getElementById('frame'),
      panelTitle: document.getElementById('panelTitle'),
      openNew: document.getElementById('openNew'),
      closeModal: document.getElementById('closeModal'),
      addBtn: document.getElementById('addBtn'),
      resetBtn: document.getElementById('resetBtn'),
      howBtn: document.getElementById('howBtn'),
      dlg: document.getElementById('dlg'),
      form: document.getElementById('form'),
      how: document.getElementById('how'),
    };

    function loadCustom(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      }catch{ return []; }
    }
    function saveCustom(arr){
      localStorage.setItem(LS_KEY, JSON.stringify(arr));
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c)=>({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[c]));
    }

    function card(game, isCustom=false){
      const tags = (game.tags || []).slice(0,6).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('');
      const del = isCustom ? `<button class="danger" data-del="${escapeHtml(game.id)}">åˆ é™¤</button>` : '';

      return `
        <div class="card">
          <h2>${escapeHtml(game.name)}</h2>
          <p>${escapeHtml(game.desc || 'â€”')}</p>
          <div class="meta">${tags}</div>
          <div class="actions">
            <button class="primary" data-play="${escapeHtml(game.id)}">â–¶ å¼€å§‹</button>
            <button data-open="${escapeHtml(game.id)}">â†— ç›´æ¥æ‰“å¼€</button>
            ${del}
          </div>
        </div>
      `;
    }

    function render(){
      const custom = loadCustom();
      const list = [...BUILTIN, ...custom];
      els.grid.innerHTML = list.map(g=>card(g, !BUILTIN.find(b=>b.id===g.id))).join('');

      els.grid.querySelectorAll('[data-play]').forEach(btn=>{
        btn.addEventListener('click', ()=> play(btn.getAttribute('data-play')));
      });
      els.grid.querySelectorAll('[data-open]').forEach(btn=>{
        btn.addEventListener('click', ()=> openDirect(btn.getAttribute('data-open')));
      });
      els.grid.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', ()=> delCustom(btn.getAttribute('data-del')));
      });
    }

    function getById(id){
      const custom = loadCustom();
      return BUILTIN.find(g=>g.id===id) || custom.find(g=>g.id===id);
    }

    function play(id){
      const g = getById(id);
      if(!g) return;
      els.panelTitle.textContent = g.name;
      els.frame.src = g.url;
      els.modal.classList.add('show');
      els.modal.setAttribute('aria-hidden','false');
      els.openNew.onclick = ()=> window.open(g.url, '_blank');
    }
    function openDirect(id){
      const g = getById(id);
      if(!g) return;
      window.open(g.url, '_blank');
    }
    function close(){
      els.modal.classList.remove('show');
      els.modal.setAttribute('aria-hidden','true');
      els.frame.src = 'about:blank';
    }

    function delCustom(id){
      const custom = loadCustom().filter(x=>x.id!==id);
      saveCustom(custom);
      render();
    }

    function uid(){
      return 'g_' + Math.random().toString(16).slice(2) + Date.now().toString(16);
    }

    els.closeModal.addEventListener('click', close);
    els.modal.addEventListener('click', (e)=>{ if(e.target === els.modal) close(); });
    window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && els.modal.classList.contains('show')) close(); });

    els.addBtn.addEventListener('click', ()=>{
      els.form.reset();
      els.dlg.showModal();
    });

    els.form.addEventListener('close', ()=>{});

    els.dlg.addEventListener('close', ()=>{
      if(els.dlg.returnValue !== 'ok') return;
      const fd = new FormData(els.form);
      const name = String(fd.get('name')||'').trim();
      const url = String(fd.get('url')||'').trim();
      const desc = String(fd.get('desc')||'').trim();
      const tags = String(fd.get('tags')||'').split(',').map(s=>s.trim()).filter(Boolean);
      if(!name || !url) return;

      const custom = loadCustom();
      custom.unshift({ id: uid(), name, url, desc, tags });
      saveCustom(custom);
      render();
    });

    els.resetBtn.addEventListener('click', ()=>{
      if(confirm('ç¡®å®šæ¸…ç©ºä½ æ‰‹åŠ¨æ·»åŠ çš„æ¸¸æˆåˆ—è¡¨å—ï¼Ÿï¼ˆä¸ä¼šåˆ é™¤æ–‡ä»¶ï¼‰')){
        localStorage.removeItem(LS_KEY);
        render();
      }
    });

    els.howBtn.addEventListener('click', ()=> els.how.showModal());

    render();
  </script>
</body>
</html>
